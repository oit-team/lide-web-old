(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-76d5b619"],{"9d84":function(e,t,o){"use strict";o("cc80")},cc80:function(e,t,o){},cdec:function(e,t,o){"use strict";o.r(t);var s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"pageCommonStyle",attrs:{id:"addGoods"}},[o("el-page-header",{attrs:{content:e.title},on:{back:e.goBack}}),o("el-divider"),o("el-form",{ref:"ruleForm",staticStyle:{"margin-top":"20px"},attrs:{rules:e.rules,model:e.ruleForm,"label-width":"98px","label-position":"right"}},[o("div",{staticClass:"goodsFormBox"},[o("div",{staticClass:"baseInfoBox"},[o("el-collapse",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[o("el-collapse-item",{attrs:{title:"基础信息",name:"1"}},[o("el-form-item",{attrs:{label:"商品名称",prop:"goodsName"}},[o("el-input",{staticStyle:{width:"96%"},attrs:{placeholder:"请输入商品名称"},model:{value:e.ruleForm.goodsName,callback:function(t){e.$set(e.ruleForm,"goodsName",t)},expression:"ruleForm.goodsName"}})],1),o("el-form-item",{attrs:{label:"作者编号",prop:"authorId"}},[o("el-select",{staticStyle:{width:"96%"},attrs:{filterable:"",placeholder:"请选择作者"},model:{value:e.ruleForm.authorId,callback:function(t){e.$set(e.ruleForm,"authorId",t)},expression:"ruleForm.authorId"}},e._l(e.authorList,(function(e){return o("el-option",{key:e.id,attrs:{label:e.authorName,value:e.id}})})),1)],1),o("el-form-item",{attrs:{label:"商品风格",prop:"goodsStyle"}},[o("el-input",{staticStyle:{width:"96%"},attrs:{placeholder:"请输入商品风格"},model:{value:e.ruleForm.goodsStyle,callback:function(t){e.$set(e.ruleForm,"goodsStyle",t)},expression:"ruleForm.goodsStyle"}})],1),o("el-form-item",{attrs:{label:"商品类型",prop:"goodsCategory"}},[o("el-select",{staticStyle:{width:"96%"},attrs:{placeholder:"请选择商品类型"},model:{value:e.ruleForm.goodsCategory,callback:function(t){e.$set(e.ruleForm,"goodsCategory",t)},expression:"ruleForm.goodsCategory"}},e._l(e.goodsTypeList,(function(e){return o("el-option",{key:e.id,attrs:{label:e.dictitemDisplayName,value:e.id}})})),1)],1),o("el-form-item",{attrs:{label:"商品价格",prop:"price"}},[o("el-input",{staticStyle:{width:"96%"},attrs:{placeholder:"请输入商品价格"},model:{value:e.ruleForm.price,callback:function(t){e.$set(e.ruleForm,"price",t)},expression:"ruleForm.price"}})],1)],1),o("el-collapse-item",{attrs:{title:"配置信息",name:"2"}},[o("el-form-item",{attrs:{label:"商品尺寸",prop:"goodsSize"}},[o("el-input",{staticStyle:{width:"96%"},attrs:{placeholder:"请输入商品尺寸"},model:{value:e.ruleForm.goodsSize,callback:function(t){e.$set(e.ruleForm,"goodsSize",t)},expression:"ruleForm.goodsSize"}})],1),o("el-form-item",{attrs:{label:"商品材质",prop:"goodsMaterials"}},[o("el-input",{staticStyle:{width:"96%"},attrs:{placeholder:"请输入商品材质"},model:{value:e.ruleForm.goodsMaterials,callback:function(t){e.$set(e.ruleForm,"goodsMaterials",t)},expression:"ruleForm.goodsMaterials"}})],1),o("el-form-item",{attrs:{label:"外观描述",prop:"appearanceDescription"}},[o("el-input",{staticStyle:{width:"96%"},attrs:{placeholder:"请输入外观描述"},model:{value:e.ruleForm.appearanceDescription,callback:function(t){e.$set(e.ruleForm,"appearanceDescription",t)},expression:"ruleForm.appearanceDescription"}})],1),o("el-form-item",{attrs:{label:"商品标签",prop:"goodsLabel"}},[o("el-input",{staticStyle:{width:"96%"},attrs:{placeholder:"请输入商品标签"},model:{value:e.ruleForm.goodsLabel,callback:function(t){e.$set(e.ruleForm,"goodsLabel",t)},expression:"ruleForm.goodsLabel"}})],1),o("el-form-item",{attrs:{label:"适用场景",prop:"purposes"}},[o("el-input",{staticStyle:{width:"96%"},attrs:{placeholder:"请输入适用场景"},model:{value:e.ruleForm.purposes,callback:function(t){e.$set(e.ruleForm,"purposes",t)},expression:"ruleForm.purposes"}})],1),o("el-form-item",{attrs:{label:"注意事项",prop:"mattersNeeding"}},[o("el-input",{staticStyle:{width:"96%"},attrs:{placeholder:"请输入注意事项"},model:{value:e.ruleForm.mattersNeeding,callback:function(t){e.$set(e.ruleForm,"mattersNeeding",t)},expression:"ruleForm.mattersNeeding"}})],1)],1)],1)],1),o("div",{staticClass:"fileInfoBox"},[o("el-form-item",{attrs:{label:"商品图片"}},[o("el-upload",{attrs:{action:e.uploadUrl,data:e.uploadData,headers:e.headersData,multiple:"",limit:6,"file-list":e.fileList,"on-change":e.uploadChange,"list-type":"picture-card",accept:"image/*","before-upload":e.beforeUploadImg,"on-exceed":e.handleExceed,"on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove}},[o("i",{staticClass:"el-icon-plus"})])],1),o("p",{staticClass:"tip"},[e._v("*最多可以上传6张图片(按住Ctrl或Alt键选择多张图片上传)")]),o("el-form-item",{attrs:{label:"商品视频"}},[o("el-upload",{class:e.videoSrc?"el-upload-video":"",attrs:{action:e.uploadUrl,data:e.uploadData,headers:e.headersData,"on-progress":e.uploadVideoProcess,multiple:"","show-file-list":!1,"list-type":"picture-card",accept:".mp4,.mov","before-upload":e.beforeUploadVideo,"on-success":e.VideoUploadSuccess}},[e.videoSrc?o("video",{staticClass:"avatar video-avatar",attrs:{src:e.videoSrc,controls:"controls"}},[e._v(" 您的浏览器不支持视频播放 ")]):e._e(),!e.videoSrc&&e.uploadVideoFlag?o("el-progress",{attrs:{type:"circle",percentage:e.perValue}}):e._e(),e.videoSrc||e.uploadVideoFlag?e._e():o("i",{staticClass:"el-icon-plus"})],1),e.videoSrc?o("div",{staticStyle:{"margin-top":"10px"}},[o("el-button",{on:{click:e.delVideo}},[e._v("删除视频")])],1):e._e()],1),o("p",{staticClass:"tip"},[e._v("*最多可以上传1个视频,推荐格式mp4")]),o("el-form-item",{attrs:{label:"视频贴图"}},[o("el-upload",{attrs:{action:e.uploadUrl,data:e.uploadData,headers:e.headersData,multiple:"",limit:1,"file-list":e.videoImgList,"on-change":e.VideouploadChange,"list-type":"picture-card",accept:"image/jpeg,image/jpg","before-upload":e.beforeUploadImg,"on-exceed":e.handleVideoExceed,"on-preview":e.handlePictureCardPreview,"on-remove":e.handleVideoImgRemove}},[o("i",{staticClass:"el-icon-plus"})])],1),o("p",{staticClass:"tip"},[e._v("*最多可以上传1张图片，仅支持jpg格式")])],1)]),o("el-form-item",{staticClass:"buttonBox"},["read"!=e.flag?o("el-button",{attrs:{size:"small",icon:"el-icon-check",type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("保存")]):e._e(),e.editFlag?e._e():o("el-button",{attrs:{size:"small",icon:"el-icon-refresh"},on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重置")])],1)],1),o("el-dialog",{attrs:{visible:e.dialogVisible,"show-close":!0,"before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[o("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)},a=[],r={name:"AddGoods",props:{},data(){return{dialogVisible:!1,dialogImageUrl:"",uploadVideoFlag:!1,perValue:0,videoSrc:"",goodsTypeList:[],authorList:[],uploadUrl:"",uploadData:{totalSize:"",startPos:0,endPos:"",fileType:1,userId:"",fname:"",noThumb:""},headersData:{token:""},activeName:"1",fileList:[],videoImgList:[],timerType:"",TreeMenuList:[],editFlag:!1,title:"",ruleForm:{goodsName:"",authorId:"",goodsStyle:"",goodsCategory:"",price:"",goodsId:"",goodsSize:"",goodsMaterials:"",appearanceDescription:"",mattersNeeding:"",goodsLabel:"",purposes:""},rules:{goodsName:[{required:!0,message:"请输入商品名称",trigger:"blur"}],authorId:[{required:!0,message:"请选择作者编号",trigger:"blur"}],goodsStyle:[{required:!0,message:"请输入商品风格",trigger:"blur"}],goodsCategory:[{required:!0,message:"请选择商品类型",trigger:"blur"}],price:[{required:!0,message:"请输入商品价格",trigger:"blur"}]},flag:""}},created(){this.$route.query.item?(this.title="编辑商品",this.editFlag=!0,this.ruleForm.goodsId=this.$route.query.item.goodsId,this.ruleForm.goodsName=this.$route.query.item.goodsName,this.ruleForm.authorId=this.$route.query.item.authorId,this.ruleForm.goodsStyle=this.$route.query.item.goodsStyle,this.ruleForm.price=this.$route.query.item.price,this.ruleForm.goodsSize=this.$route.query.item.goodsSize,this.ruleForm.goodsMaterials=this.$route.query.item.goodsMaterials,this.ruleForm.appearanceDescription=this.$route.query.item.appearanceDescription,this.ruleForm.purposes=this.$route.query.item.purposes,this.ruleForm.mattersNeeding=this.$route.query.item.mattersNeeding,this.ruleForm.goodsLabel=this.$route.query.item.goodsLabel,this.ruleForm.goodsCategory=Number(this.$route.query.item.goodsCategory),this.fileList=this.$route.query.item.mainImage?this.setFileList(this.$route.query.item.mainImage):[],this.videoSrc=this.$route.query.item.video,this.videoImgList=this.$route.query.item.videoImage?this.setFileList([{resUrl:this.$route.query.item.videoImage}]):[],this.$route.query.flag&&(this.flag=this.$route.query.flag,console.log(this.flag))):this.title="新增商品"},mounted(){this.headersData.token=sessionStorage.accessToken,this.uploadData.userId=sessionStorage.userId,this.uploadUrl=this.Api.uploadFile,this.getGoodsType(),this.getAuthorList()},activated(){},watch:{},methods:{handleClose(){this.dialogVisible=!1},goBack(){this.$router.go(-1)},getAuthorList(){const e=this,t={pageNum:1,pageSize:9999},o=e.GLOBAL.paramJson(t);e.$axios.post(e.Api.getAuthorInfoList,o).then(t=>{0===t.data.head.status?e.authorList=t.data.body.resultList:e.$message({message:t.data.head.msg,type:"warning"})})},getGoodsType(){const e=this,t={},o=e.GLOBAL.paramJson(t);e.$axios.post(e.Api.getGoodsCategory,o).then(t=>{e.goodsTypeList=t.data.body.result})},setFileList(e){const t=[];return e.forEach(e=>{const o=e.resUrl.lastIndexOf("/"),s=e.resUrl.substring(o+1);t.push({name:s,url:e.resUrl})}),t},getImgList(e){let t=[];return e.forEach(e=>{e.response?t.push(e.response.fileUrl):t.push(e.url)}),t.toString()},submitForm(e){const t=this;t.$refs[e].validate(e=>{if(e){const e={goodsName:t.ruleForm.goodsName,authorId:t.ruleForm.authorId,goodsStyle:t.ruleForm.goodsStyle,goodsCategory:t.ruleForm.goodsCategory,price:t.ruleForm.price,mainImage:t.getImgList(t.fileList),goodsSize:t.ruleForm.goodsSize,goodsMaterials:t.ruleForm.goodsMaterials,appearanceDescription:t.ruleForm.appearanceDescription,mattersNeeding:t.ruleForm.mattersNeeding,goodsLabel:t.ruleForm.goodsLabel,video:t.videoSrc,videoImage:t.getImgList(t.videoImgList),purposes:t.ruleForm.purposes};if(t.editFlag){e.goodsId=t.ruleForm.goodsId;const o=t.GLOBAL.paramJson(e);t.$axios.post(t.Api.updateGoodsInfo,o).then(e=>{0===e.data.head.status?(t.$message({message:"编辑任务成功",type:"success"}),t.$bus.$emit("detailShow",""),t.$router.back()):t.$message({message:e.data.head.msg,type:"warning"})}).catch(e=>{console.log(e)})}else{const o=t.GLOBAL.paramJson(e);t.$axios.post(t.Api.addGoodsInfo,o).then(e=>{0===e.data.head.status?(t.$message({message:"新增商品成功",type:"success"}),t.$bus.$emit("detailShow",""),t.$router.back()):t.$message({message:e.data.head.msg,type:"warning"})}).catch(e=>{console.log(e)})}}})},resetForm(e){this.$refs[e].resetFields()},handleRemove(e,t){this.fileList=t},handleVideoImgRemove(e,t){this.videoImgList=t},handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},beforeUploadImg(e){this.uploadData.totalSize=parseInt(e.size/1024),this.uploadData.endPos=e.size,this.uploadData.fileType="0";const t=e.name.lastIndexOf("."),o=e.name.substring(t+1),s=e.size/1024/1024<4,a=Math.floor(Date.now()/36e5),r=`${this.md5(e.name+a).toString()}.${o}`;return this.uploadData.fname=r,s||(this.$message.error("上传图片大小不能超过 4MB!"),!1)},handleExceed(e,t){this.$message.warning(`当前限制选择 6 个文件，本次选择了 ${e.length} 个文件，共选择了 ${e.length+t.length} 个文件`)},handleVideoExceed(e,t){this.$message.warning(`当前限制选择 1 个文件，本次选择了 ${e.length} 个文件，共选择了 ${e.length+t.length} 个文件`)},uploadChange(e,t){this.fileList=t},VideouploadChange(e,t){this.videoImgList=t},uploadVideoProcess(e,t,o){this.uploadVideoFlag=!0,this.perValue=1*t.percentage.toFixed(0)},beforeUploadVideo(e){this.delVideo(),this.uploadData.totalSize=parseInt(e.size/1024),this.uploadData.endPos=e.size,this.uploadData.fileType="1";const t=e.name.lastIndexOf("."),o=e.name.substring(t+1),s="mp4"===o||"mov"===o,a=e.size/1024/1024<50,r=Math.floor(Date.now()/36e5),i=`${this.md5(e.name+r).toString()}.${o}`;return this.uploadData.fname=i,s?a?s&&a:(this.$message.error("上传视频大小不能超过 50MB!"),!1):(this.$message.error("上传视频只能是 mp4，mov 格式!"),!1)},VideoUploadError(){},VideoUploadSuccess(e,t){this.uploadVideoFlag=!1,this.perValue=0,0===e.status?this.videoSrc=e.fileUrl:this.$message.error("上传失败")},delVideo(){this.videoSrc=""}}},i=r,l=(o("9d84"),o("b709")),d=Object(l["a"])(i,s,a,!1,null,"7699f762",null);t["default"]=d.exports}}]);